var quail=function(){"use strict";function t(t,i,u,c){return new(u=u||Promise)(function(n,e){function o(t){try{r(c.next(t))}catch(t){e(t)}}function s(t){try{r(c.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(o,s)}r((c=c.apply(t,i||[])).next())})}function i(o,s){var r,i,u,c={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},a={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function t(n){return function(t){var e=[n,t];if(r)throw new TypeError("Generator is already executing.");for(;c=a&&e[a=0]?0:c;)try{if(r=1,i&&(u=2&e[0]?i.return:e[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,e[1])).done)return u;switch(i=0,(e=u?[2&e[0],u.value]:e)[0]){case 0:case 1:u=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,i=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(u=0<(u=c.trys).length&&u[u.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!u||e[1]>u[0]&&e[1]<u[3]))c.label=e[1];else if(6===e[0]&&c.label<u[1])c.label=u[1],u=e;else{if(!(u&&c.label<u[2])){u[2]&&c.ops.pop(),c.trys.pop();continue}c.label=u[2],c.ops.push(e)}}e=s.call(o,c)}catch(t){e=[6,t],i=0}finally{r=u=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}}function e(t,e,n){void 0===n&&(n="https://api.quail.ink"),this.apibase="",this.apikey="",this.access_token="",this.apikey=t,this.access_token=e,this.apibase=n}return e.prototype.getAccessToken=function(){if(""===(n=this.access_token)){var t=localStorage.getItem("auth");if(t)try{var e=JSON.parse(t),n=e.access_token||e.token}catch(t){n=""}}return n=""===n?window._access_token:n},e.prototype.request=function(o,s,r){return t(this,void 0,void 0,function(){var e,n;return i(this,function(t){switch(t.label){case 0:return o=this.apibase+o,e={"Content-Type":"application/json"},(n=this.getAccessToken())&&(e.Authorization="Bearer ".concat(n)),this.apikey&&(e["X-QUAIL-Key"]=this.apikey),[4,fetch(o,{method:s,headers:e,body:r?JSON.stringify(r):null})];case 1:return[4,t.sent().json()];case 2:if((n=t.sent()).code)throw console.log("error",n.code,n.message||n.msg),new Error("".concat(n.code,": ").concat(n.message||n.msg));return[2,n.data]}})})},e.prototype.requestFormData=function(o,s){return t(this,void 0,void 0,function(){var e,n;return i(this,function(t){switch(t.label){case 0:return o=this.apibase+o,e={},(n=this.getAccessToken())&&(e.Authorization="Bearer ".concat(n)),this.apikey&&(e["X-QUAIL-Key"]=this.apikey),[4,fetch(o,{method:"POST",headers:e,body:s||null})];case 1:return[4,t.sent().json()];case 2:return[2,(n=t.sent()).data||{code:null==n?void 0:n.code,message:null==n?void 0:n.message}]}})})},e.prototype.getAuthCode=function(t,e){var n=navigator.language;return 2<n.length&&(n=n.substring(0,2)),this.request("/auth/code","POST",{email:t,lang:n,"challenge-action":"request_auth_code","challenge-token":e})},e.prototype.login=function(t,e){var n=navigator.language;return 2<n.length&&(n=n.substring(0,2)),this.request("/auth/login","POST",{method:"email_code",email:t,code:e,lang:n})},e.prototype.getAssets=function(){return this.request("/assets","GET",null)},e.prototype.getAsset=function(t){return this.request("/assets/".concat(t),"GET",null)},e.prototype.getMe=function(){return this.request("/users/me","GET",null)},e.prototype.subscribe=function(t,e,n){return this.request("/subscriptions/".concat(t),"POST",{email:e,"challenge-action":"subscribe","challenge-token":n})},e.prototype.getMySubscriptions=function(){return this.request("/subscriptions","GET",null)},e.prototype.subscribeNoChallenge=function(t){return this.request("/subscriptions/".concat(t,"/no-challenge"),"POST",null)},e.prototype.unsubscribe=function(t,e){return void 0===e&&(e=""),this.request("/subscriptions/".concat(t),"DELETE",{trace_id:e})},e.prototype.upgradeSubscription=function(t,e){return void 0===e&&(e=""),this.request("/subscriptions/".concat(t,"/upgrade?redirect_url=").concat(e),"POST",null)},e.prototype.getListPosts=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=10),this.request("/lists/".concat(t,"/posts?offset=").concat(e,"&limit=").concat(n),"GET",null)},e.prototype.getPinnedPosts=function(t){return this.request("/lists/".concat(t,"/pinned"),"GET",null)},e.prototype.getPost=function(t,e){return this.request("/lists/".concat(t,"/posts/").concat(e),"GET",null)},e.prototype.getLists=function(t){return this.request("/users/".concat(t,"/lists"),"GET",null)},e.prototype.getList=function(t){return this.request("/lists/".concat(t),"GET",null)},e.prototype.updateList=function(t,e){return this.request("/lists/".concat(t),"PUT",{slug:e.slug||"",avatar_image_url:e.avatar_image_url||"",title:e.title||"",description:e.description||""})},e.prototype.updateListTelegram=function(t,e){return this.request("/lists/".concat(t,"/telegram"),"PUT",{telegram_bot_token:e.telegram_bot_token||"",telegram_channel_id:e.telegram_channel_id||""})},e.prototype.getListSubscriptions=function(t,e,n){return this.request("/lists/".concat(t,"/subscriptions?offset=").concat(e,"&limit=").concat(n),"GET",null)},e.prototype.getApikeys=function(){return this.request("/apikeys","GET",null)},e.prototype.deleteApikey=function(t){return this.request("/apikeys/".concat(t),"DELETE",null)},e.prototype.createApikey=function(t){return this.request("/apikeys","POST",{name:t})},e.prototype.createPost=function(e,n){return t(this,void 0,void 0,function(){return i(this,function(t){return[2,this.request("/lists/".concat(e,"/posts"),"POST",n)]})})},e.prototype.publishPost=function(e,n){return t(this,void 0,void 0,function(){return i(this,function(t){return[2,this.request("/lists/".concat(e,"/posts/").concat(n,"/publish"),"PUT",null)]})})},e.prototype.unpublishPost=function(e,n){return t(this,void 0,void 0,function(){return i(this,function(t){return[2,this.request("/lists/".concat(e,"/posts/").concat(n,"/unpublish"),"PUT",null)]})})},e.prototype.deliverPost=function(e,n){return t(this,void 0,void 0,function(){return i(this,function(t){return[2,this.request("/lists/".concat(e,"/posts/").concat(n,"/deliver"),"PUT",null)]})})},e.prototype.uploadAttachment=function(e){return t(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,this.requestFormData("/attachments",e)];case 1:return[2,t.sent()]}})})},e}();
